class FlowField{constructor(s,t){this.inc=.1,this.scl=10,this.numberParticles=300,this.buffer=createGraphics(s,t),this.particles=[],this.create_grid(),this.create_particles()}create_grid(){this.cols=floor(this.buffer.width/this.scl),this.rows=floor(this.buffer.height/this.scl),this.flowfield=new Array(this.cols*this.rows)}create_particles(){for(var s=0;s<this.numberParticles;s++)this.particles[s]=new FlowFieldParticle(this.buffer,this.scl,this.cols)}update_particles(){for(var s=0;s<this.particles.length;s++)this.particles[s].follow(this.flowfield),this.particles[s].update(),this.particles[s].edges(),this.particles[s].show()}update_noise(){for(var s=0,t=0,i=0;i<this.rows;i++){for(var e=0,h=0;h<this.cols;h++){var r=h+i*this.cols,o=noise(e,t,s)*TWO_PI*4,l=p5.Vector.fromAngle(o);l.setMag(1),this.flowfield[r]=l,e+=this.inc}t+=this.inc,s+=3e-4}return this.update_particles(),this.buffer}}class FlowFieldParticle{constructor(s,t,i){this.buffer=s,this.scl=t,this.cols=i,this.pos=createVector(getRandomFromInterval(0,this.buffer.width),getRandomFromInterval(0,this.buffer.height)),this.vel=createVector(0,0),this.acc=createVector(0,0),this.maxspeed=4,this.prevPos=this.pos.copy()}update(){this.vel.add(this.acc),this.vel.limit(this.maxspeed),this.pos.add(this.vel),this.acc.mult(0)}follow(s){var t=s[floor(this.pos.x/this.scl)+floor(this.pos.y/this.scl)*this.cols];this.applyForce(t)}applyForce(s){this.acc.add(s)}show(){this.buffer.push(),this.buffer.stroke(255,5),this.buffer.strokeWeight(1),this.buffer.line(this.pos.x,this.pos.y,this.prevPos.x,this.prevPos.y),this.buffer.pop(),this.updatePrev()}updatePrev(){this.prevPos.x=this.pos.x,this.prevPos.y=this.pos.y}edges(){this.pos.x>this.buffer.width&&(this.pos.x=0,this.updatePrev()),this.pos.x<0&&(this.pos.x=this.buffer.width,this.updatePrev()),this.pos.y>this.buffer.height&&(this.pos.y=0,this.updatePrev()),this.pos.y<0&&(this.pos.y=this.buffer.height,this.updatePrev())}}